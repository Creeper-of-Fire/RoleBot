# RoleBot - 全能型 Discord 服务器增强助手

**RoleBot** 不再仅仅是一个身份组管理工具，它已经进化为一个功能全面、高度集成化的 Discord 服务器增强助手。它旨在通过模块化的设计，为社区提供从用户互动、自动化管理到数据追踪的全方位解决方案。机器人完全基于斜杠命令和现代化的交互组件，为用户和管理员带来流畅的体验。

## ✨ 核心功能一览

RoleBot 采用模块化（Cogs）设计，您可以根据需要在 `config.py` 中轻松启用或禁用以下任何功能：

### 🧑‍🤝‍🧑 用户身份与外观

*   **⏱️ 限时高亮组 (Timed Roles)**: 用户每天拥有固定的“高亮时长”，可以用来佩戴特殊的、改变昵称颜色的身份组。时间耗尽后，身份组将自动移除，每日定时重置。
*   **🔔 通知与权限组 (Self-Service Roles)**: 用户可以随时通过面板自由领取或移除的普通身份组，非常适合用于频道权限、活动通知、身份标签等。
*   **👗 幻化衣橱 (Fashion Wardrobe)**: 允许拥有“基础身份组”的用户，为其佩戴一个或多个对应的“幻化身份组”。幻化身份组通常用于覆盖基础身份组的颜色，提供个性化外观。系统会智能判断并展示所有可用的幻化选项。

### 🏆 社区激励与荣誉

*   **🌟 荣誉系统 (Honor System)**: 一个全面的成就系统，用于奖励用户的社区贡献。
    *   **加入纪念**: 根据用户加入服务器的时间自动授予周年纪念等荣誉。
    *   **发帖成就**: 根据用户在指定论坛版区的发帖数量，自动授予“筑基小生”、“金丹长老”等里程碑荣誉。
    *   **活动荣誉**: 可配置在特定活动期间发帖即可获得限定荣誉。
    *   **自助领取**: 管理员可以设置某些荣誉，让用户通过面板自行领取。
    *   **个人荣誉墙**: 每个用户都有一个私密的荣誉墙，可以查看自己已获得、未获得以及已佩戴的荣誉。

### 📈 社区洞察与活跃度

*   **📊 活跃度追踪 (Activity Tracker)**:
    *   **数据记录**: 基于 **Redis** 高效记录用户在指定频道内的发言活动。
    *   **活跃度角色**: 用户可以通过面板检查自己过去N天的发言数，如果达标，可自动申领/移除“活跃分子”等身份组。
    *   **个人报告**: 生成详细的个人活跃度报告，包含分频道消息数统计和**发言热力图**。
    *   **数据导出**: 管理员可以将服务器的活跃数据按天或小时聚合，导出为 `.csv` 文件。

### ⚙️ 自动化与管理

*   **🔗 身份组同步 (Role Sync)**: 强大的自动化规则引擎。
    *   **实时同步**: 当用户获得身份组A时，立即自动授予身份组B。
    *   **每日同步**: 机器人每日检查拥有身份组C的用户，并为他们补全身份组D。
    *   **手动回填**: 管理员可一键为所有符合规则但未同步的用户执行补发。
*   **📝 身份组申请 (Role Application)**:
    *   **条件申领**: 用户满足特定条件（如拥有某个前置身份组）即可通过按钮自助领取角色。
    *   **作品审核**: 创作者可以通过提交其在论坛的作品链接来申请“创作者”身份组，机器人会自动验证帖子的**反应数**是否达标。（此功能和其他机器人重复且不甚完善，已禁用）
*   **📰 心跳资讯 (Heartbeat Information)**: 强大的跨频道内容同步工具，提供两种模式：
    *   **实时同步 (Live Sync)**: 管理员可以创建一个持久化的“资讯”消息，它会自动、实时地同步另一个频道（甚至是另一个服务器的频道）的**最新消息**或**指定消息**。非常适合用于制作信息公告板或跨服通知。
    *   **手动快照 (Manual Snapshot)**: 用户可以使用 `/服务器资讯 调取` 命令来获取任意资讯的**当前内容快照**，并以**私密消息**的形式查看，不打扰公共频道。或使用 `/服务器资讯 发送` 将其**公开发布**到当前频道。

## 🚀 架构与技术亮点

*   **✨ 现代化的面板驱动体验**:
    *   **告别指令记忆**: 普通用户几乎看不到任何指令，几乎所有操作都通过一个统一的入口面板分发，然后进入各自的私有交互界面。
    *   **无缝交互**: 广泛使用斜杠命令、可分页列表、模态框表单和私密消息（Ephemeral Messages），为管理员/用户提供干净、私密且直观的现代应用体验。

*   **🛡️ 安全性与可靠性**:
    *   **权限护栏**: 内置“危险权限”列表 (`DANGEROUS_PERMISSIONS`)，从根本上杜绝用户通过自助服务获取管理员、管理角色等高危权限的可能性。(实际上依旧有可能，但是可能性大大降低)
    *   **数据持久化与备份**: 核心数据分别使用 JSON、SQLite (`Alembic`管理) 和 Redis 进行持久化。同时提供一键备份指令，将所有本地数据打包为 `.zip` 文件，方便迁移和保管。
    *   **隐私保护**: 所有个人操作面板均为用户私有，避免在公共频道中造成信息泄露或刷屏。

*   **🧩 高内聚、低耦合的模块化核心**:
    *   **中央协调者 (`CoreCog`)**: 项目的核心 `CoreCog` 扮演着中央协调者的角色，它不处理具体业务，而是负责管理和调度所有“功能模块”（如荣誉系统、幻化系统等）。
    *   **插件化设计**: 大部分和`CoreCog`存在耦合的功能模块都像一个独立的插件，向 `CoreCog` 注册自己的入口按钮和缓存更新逻辑。这使得添加或移除功能变得异常简单，且不会影响到其他模块。
    *   **统一入口**: `CoreCog` 负责生成包含所有已启用功能入口的“主控制面板”，实现了功能的自动聚合。

*   **🔗 动态内容管理 (`EmbedLink` 系统)**:
    *   **告别硬编码**: 幻化衣橱、荣誉墙等模块的“指引”或“说明”面板内容不再硬编码在代码中。
    *   **在Discord中管理**: 管理员可以在服务器中发布或编辑一条消息，然后使用 `/核心 配置embed链接` 指令，将这条消息的内容与某个功能模块的指引面板进行“绑定”。
    *   **即时更新**: 当管理员编辑那条源消息后，机器人面板中的指引内容会自动更新，**无需修改代码或重启机器人**，极大地提升了内容管理效率。

## 🔧 安装与一键部署

得益于 **Docker** 和预设的 **PowerShell** 部署脚本，将 RoleBot 部署到你的服务器从未如此简单。

### 前提条件

1.  一台拥有公网IP的Linux服务器（推荐 Ubuntu/Debian）。
2.  服务器上已安装 `Docker` 和 `docker-compose`。
3.  本地电脑为 Windows 系统，并安装了 PowerShell 和 SSH 客户端（Win10/11 已内置）。（Linux电脑可能需要传统部署方式）
4.  一个 SSH 密钥对，用于免密登录你的服务器。

### 步骤 1: 本地配置

1.  **获取项目文件**:
    *   使用`git clone <你的仓库URL>`命令克隆仓库。
    *   或使用其他方便的工具，如 [Github Desktop](https://desktop.github.com/)。

2.  **配置机器人 (`.env`)**:
    *   在项目根目录下，复制 `配置文件示例（请放在项目根目录）/.env.example` 并重命名为 `.env`。
    *   填入你的机器人 `DISCORD_BOT_TOKEN`。

3.  **配置核心功能 (`config.py` & `config_data.py`)**:
    *   这是项目的核心，根据你的服务器ID、角色ID、频道ID等，详细配置 `config.py` 和 `config_data.py` 中的各个模块。文件内有详尽的中文注释。

4.  **配置部署脚本 (`deploy.env`)**:
    *   在项目根目录下，复制 `配置文件示例（请放在项目根目录）/deploy.example.env` 并重命名为 `deploy.env`。
    *   填入你服务器的 `SSH_HOST` (IP地址)、`SSH_USER` (通常是 `root`)，以及你本地私钥文件的**绝对路径** `SSH_PRIVATE_KEY_PATH`。

### 步骤 2: 一键部署！

配置完成后，部署只需一个命令。你可以选择以下任一方案：

#### 方案一：通过 IDE 运行
*   在 VSCode 等支持 PowerShell 的 IDE 中，直接打开 `deploy.ps1` 文件，点击运行按钮（可能需要安装相应插件）。

#### 方案二：通过 PowerShell 运行
*   打开 **PowerShell** 终端，导航到 `role_bot` 项目根目录。
*   运行部署脚本：
    ```powershell
    .\deploy.ps1
    ```

**这个脚本会自动完成以下所有工作：**

1.  读取 `deploy.env` 获取服务器信息。
2.  将你本地的整个项目（除了`.git`、`.env`等敏感或不必要的文件）打包成一个临时的 `.zip` 文件。
3.  使用 `scp` 将压缩包安全地传输到你的远程服务器。
4.  通过 `ssh` 连接到服务器，执行以下远程操作：
    *   清空旧的项目文件。
    *   解压新的项目文件。
    *   使用 `docker-compose build` 构建最新的机器人镜像。
    *   使用 `alembic upgrade head` 自动更新数据库结构。
    *   使用 `docker-compose up -d` 启动或重启机器人容器。
    *   清理临时的压缩包和无用的Docker镜像。
5.  部署完成后，脚本会自动进入 **实时日志查看模式** (`docker logs -f rolebot`)，让你能立即看到机器人的启动情况。按 `Ctrl+C` 即可退出日志查看。

### 其他便捷脚本

*   `.\connect_rolebot.ps1`: 一键SSH登录到你的服务器。
*   `.\get_rolebot_log.ps1`: 一键连接服务器并实时查看机器人日志。

## 📖 使用与管理

*   **主面板**: 部署成功后，在你的Discord服务器中使用 `/核心 打开身份组自助中心面板` 命令，即可发送所有功能的主入口面板。
*   **管理员指令**: 大部分管理员指令都以指定名（`config.COMMAND_GROUP_NAME`）为前缀分组，方便查找和管理。

## 🤝 贡献

欢迎提交 Pull Requests 或在 Issues 中报告问题和提出建议。

## 📄 许可证

本项目采用 [MIT License](LICENSE) 开源。